<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link href="../css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" href="../css/public.css" />
		<link rel="stylesheet" href="../css/in.css" />
	</head>

	<body>
		<div id="pullrefresh" class="mui-content mui-scroll-wrapper">
			<div class="mui-scroll">
				<ul class="mui-table-view mui-table-view-chevron" id="ul">
					<div class="overSelect selectArea" id='selectArea'>
						<h2>请选择小结或总结的时间</h2>
						<ul id='itemCon' class="itemCon">
							<li class='overItem'> 07:00</li>
							<li class="overItem"> 19:00</li>
						</ul>
					</div>
					
					<!--饮食和用药的主体部分-->

					<div class="listContainer" id='listContainer'>

						<span class="listTitle select"><i></i>饮食</span>
						<span class="listTitle"><i class="medicaIcon"></i>用药</span>
						<!--饮食内容区域-->
						<div class="diet tabContainer">
							<h2>饮食方法及量</h2>
							<div class="dietMethod">
								<span class="dietName" id='dietName'></span><span class="dietNum" id='dietNum'></span>
							</div>
							<h2>入量——营养</h2>
							<!--日期和时间-->
							<div class="dataTime">
								<span id="currentDate"></span>
								<span class="time">
		    			<span><i class="one"></i></span>
								<span class="now"><input type="button"value="12:45" onclick="pickTime()"  /><i class="two"></i></span>
								<span><i class="three"></i></span>
								</span>
							</div>
							<!--输入项部分-->
							<div class="items" id='items'>

							</div>
						</div>
						<!--用药内容区域-->
						<div class="medication tabContainer" id='med'>
							<!--时间日期-->
							<div class="dataTime">
								<span id="currentDateMed"></span>
							</div>
							<h2>入量——口服药</h2>
							<div class="inDetails OralMedicine" id='OralMedicine'>

							</div>
							<h2>入量——特殊治疗</h2>
							<div class="inDetails specialTreat" id='specialTreat'>
							</div>
							<h2>入量——输液单 <s id='ScanCodeBtn'></s></h2>
							<!--输液单展示-->
							<div id="InfusionList">
							</div>
						</div>

					</div>

				</ul>
			</div>
			
		</div>
		<!--保存-->
			<div class="dietSave saveSection saveBack">
				<button id='saveBtn'>保存并上传</button>
			</div>
			<div class="medicationSave saveSection saveBack">
				<button id='scanBtn'><i></i>扫描二维码</button>
				<button id='saveSpecial'>保存并上传</button>

			</div>
		<script src="../js/mui.min.js"></script>
		<script src="../js/config.js"></script>
		<script src="../js/tool.js"></script>
		<script src="../js/public.js"></script>
		<script src="../lib/template/template.js"></script>
		<!--饮食部分的模板-->
		<script type='text/template' id='itemsDisabledTpl'>
			<ul class='disabled'>
				<li>

					<span class="itemName">经口喂养</span>
					<input type="button" value="选择时间" class='selectTime' />
					<input type="text" placeholder="请输入" disabled/>
					<span class='unit'>ml</span>
				</li>
				<li>

					<span class="itemName">鼻饲量</span>
					<input type="button" value="选择时间" class='selectTime' />
					<input type="text" placeholder="请输入" disabled/>
					<span class='unit'>ml</span>
				</li>
				<li class="lastLi">

					<span class="itemName">胃潴留量</span>
					<input type="button" value="选择时间" class='selectTime' />
					<input type="text" placeholder="请输入" disabled/>
					<span class='unit'>ml</span>
				</li>
			</ul>
		</script>
		<script type='text/template' id='itemsTpl'>

			<ul>
				{{if list}} {{each list as value i}}
				<li>

					{{if value.IntakeSupplyName=='经口'}}
					<span class="itemName" name='{{value.IntakeSupplyName}}'>经口喂养</span> {{else if value.IntakeSupplyName=='鼻饲'}}
					<span class="itemName" name='{{value.IntakeSupplyName}}'>鼻饲量</span> {{else if value.IntakeSupplyName=='胃潴留'}}
					<span class="itemName" name='{{value.IntakeSupplyName}}'>胃潴留量</span> {{/if}} {{if value.OperateTime}}
					<input type="button" value="{{value.OperateTime.substr(value.OperateTime.indexOf(" "),6)}}" onclick="selectTime('{{value.IntakeSupplyName}}')" class='selectTime' id='{{value.IntakeSupplyName}}' /> {{else}}
					<input type="button" value="选择时间" onclick="selectTime('mouthID')" class='selectTime' id='mouthID' /> {{/if}}
					<input type="text" placeholder="请输入" value='{{value.IntakeNumber}}' class='itemNum' />
					<span class='unit'>ml</span>
				</li>
				{{/each}} {{else}}
				<li>

					<span class="itemName">经口喂养</span>
					<input type="button" value="选择时间" onclick="selectTime('mouth')" class='selectTime' id='mouth' />
					<input type="text" placeholder="请输入" class='itemNum' />
					<span class='unit'>ml</span>
				</li>
				<li>

					<span class="itemName">鼻饲量</span>
					<input type="button" value="选择时间" onclick="selectTime('nose')" class='selectTime' id='nose' />
					<input type="text" placeholder="请输入" class='itemNum' />
					<span class='unit'>ml</span>
				</li>
				<li class="lastLi">

					<span class="itemName">胃潴留量</span>
					<input type="button" value="选择时间" onclick="selectTime('stomach')" class='selectTime' id='stomach' />
					<input type="text" placeholder="请输入" class='itemNum' />
					<span class='unit'>ml</span>
				</li>
				{{/if}}
			</ul>

		</script>
		<script type='text/template' id='specialTpl'>
			<ul>
				{{each list as value i}}
				<li class='saveItem'>
					<span id='OralName' IntakeName='{{value.IntakeName}}' IntakeUseType='{{value.IntakeUseType}}' OrderCode='{{value.OrderCode}}' IntakeCode='{{value.IntakeCode}}' IntakeNumber='{{value.IntakeNumber}}' OrderNumber='{{value.OrderNumber}}' IntakeUnit='{{value.IntakeUnit}}' ParentNumber='{{value.ParentNumber}}' Frequcy='{{value.Frequcy}}'>{{value.Remarks}}</span>
					<input type="button" value='添加时间' class="addTime" onclick="addTimes('{{value.Remarks}}')" />
				</li>
				<div class="times" id='{{value.Remarks}}'>
					<span class="clearBtn"></span> {{if value.Value}} {{each value.Value.split('-') as item}}
					<span class="singleTime">{{item}}</span> {{/each}} {{/if}}
				</div>
				{{/each}}
			</ul>
		</script>
		<!--输液单的模板-->
		<script type='text/template' id='infusionTpl'>
			{{each datas as value i}}
			<div class="infusionGroup" id='{{value.list[0].OPERATE_STATUS}}' }>
				<ul>
					{{each value.list as item}}
					<li>{{item.Remarks}}</li>
					{{/each}}
				</ul>
				<ul>
					<li><span class="totalNum">总量:&nbsp;<span class="totalValue"id='totalValue'>{{value.list[0].INTAKE_TOTAL}}</span>ml</span>&nbsp;<span class="Consumption">实际用量:&nbsp;<span class="ConsumptionValue"id='ConsumptionValue'>{{value.list[0].USED_TOTAL?value.list[0].USED_TOTAL:0}}</span>ml</span>
					</li>
					<li><span class="methods">给药方式:&nbsp;<span class="methodsValue">{{value.list[0].INTAKE_SUPPLY_NAME}}</span></span>
					</li>
					<li><span class="pumpSpeed">泵速:&nbsp;<span class="pumpSpeedValue"id='pumpSpeedValue'>{{value.list[0].INTAKE_PUMPSPEED}}</span></span>
					</li>
					<li><span class="executeTime">执行时间:<span class="executeTimeValue">{{value.list[0].OPERATE_TIME}}</span></span>
					</li>
					<li><span class="executor">执行人:<span class="executorValue">{{value.list[0].OPERATE_USER_NAME}}</span></span>
					</li>
				</ul>
				{{if value.list[0].OPERATE_STATUS==0 || value.list[0].OPERATE_STATUS==1 || value.list[0].OPERATE_STATUS==5 || value.list[0].OPERATE_STATUS==7}}
				<div class="groupOper opers" status='status'>
					<button class="activeOper">修改泵速</button>
					<button class="activeOper">已用量</button>
					<button class="activeOper">暂停</button>
					<button class="activeOper">停止</button>
					<div class="operPart" status='1'>
						<ul>
							<li><span>泵速</span><input type="text" placeholder="请输入泵速" id='speedId' class='inputDom' value='{{value.list[0].INTAKE_PUMPSPEED.substring(0,value.list[0].INTAKE_PUMPSPEED.indexOf("m"))}}' />ml/h</li>
							<li><span>时间</span><input type="button" onclick="updateTime('status1')" id='status1' value='选择时间' class='itemTime' /></li>
							<li><span>实入量</span><input type="text" placeholder="请输入实入量" id='inNum' class='status1 fact inputDom' />ml</li>
						</ul>
						<div class="sureUpdate" IntakeCode='{{value.list[0].INTAKE_CODE}}' IsOver='0' id='affected'>
							确定
						</div>
					</div>
					<div class="operPart" status='7'>
						<ul>
							<li><span>已完成</span><input type="checkbox" id='isComplete' /></li>
							<li><span>时间</span><input type="button" onclick="completeTime('status7')" id='status7' value='选择时间' class='itemTime' /></li>
							<li><span>实入量</span><input type="text" placeholder="请输入实入量" id='inNum' class='status7 fact inputDom' />ml</li>

						</ul>
						<div class="sureUpdate" IntakeCode='{{value.list[0].INTAKE_CODE}}' IsOver='0' id='affected'>
							确定
						</div>
					</div>
					<div class="operPart" status='6'>
						<ul>
							<li><span>时间</span><input type="button" onclick="updateTime('status6')" id='status6' value='选择时间' class='itemTime' /></li>
							<li><span>实入量</span><input type="text" placeholder="请输入实入量" id='inNum' class='status6 fact inputDom' />ml</li>
						</ul>
						<div class="sureUpdate" IntakeCode='{{value.list[0].INTAKE_CODE}}' IsOver='0' id='affected'>
							确定
						</div>
					</div>
					<div class="operPart" status='4'>
						<ul>
							<li><span>时间</span><input type="button" onclick="updateTime('status4')" id='status4' value='选择时间' class='itemTime' /></li>
							<li><span>实入量</span><input type="text" placeholder="请输入实入量" id='inNum' class='status4 fact inputDom' />ml</li>

						</ul>
						<div class="sureUpdate" IntakeCode='{{value.list[0].INTAKE_CODE}}' IsOver='0' id='affected'>
							确定
						</div>
					</div>
				</div>
				{{else if value.list[0].OPERATE_STATUS==6}}
				<div class="continumBotton opers" status='status'>
					<button id='begin' class="activeOper">继续</button>
					<div class="operPart" status='5'>
						<ul>
							<li><span>泵速</span><input type="text" placeholder="请输入泵速" id='speedId' class='inputDom' value='{{value.list[0].INTAKE_PUMPSPEED.substring(0,value.list[0].INTAKE_PUMPSPEED.indexOf("m"))}}' />ml/h</li>
							<li><span>时间</span><input type="button" onclick="selectTime('updateId')" id='updateId' value='选择时间' class='itemTime' /></li>
						</ul>
						<div class="sureUpdate" IsOver='0' IntakeCode='{{value.list[0].INTAKE_CODE}}' id='affected'>
							确定
						</div>
					</div>
				</div>
				{{/if}}
			</div>
			{{/each}}

		</script>

		<!--入量的饮食部分-->
		<script type="text/javascript">
			//			tab栏切换
			var listContainer = document.getElementById('listContainer');
			//			获取tab栏标题
			var listTitles = document.getElementsByClassName('listTitle');
			//			获取tab栏标题
			var tabContainers = document.getElementsByClassName('tabContainer');
			//			获取保存的按钮
			var saves = document.getElementsByClassName('saveSection');
			var inputFlag = false;
			//			给标题注册点击事件，并实现tab栏切换
			localStorage.setItem('saveIndex', 0);
			for(var i = 0; i < listTitles.length; i++) {
				listTitles[i].setAttribute('index', i);
				listTitles[i].addEventListener('tap', function() {
					var thisIndex = parseInt(this.getAttribute('index'));
					for(var j = 0; j < listTitles.length; j++) {
						listTitles[j].classList.remove('select');
						tabContainers[j].style.display = 'none';
						saves[j].style.display = 'none';
					}
					this.classList.add('select');
					tabContainers[thisIndex].style.display = 'block';
					saves[thisIndex].style.display = 'block';
					localStorage.setItem('saveIndex', thisIndex);
				})
			}
			//			切换到用药部分
			window.addEventListener('tabMed', function() {
				for(var j = 0; j < listTitles.length; j++) {
					listTitles[j].classList.remove('select');
					tabContainers[j].style.display = 'none';
					saves[j].style.display = 'none';
				}
				listTitles[1].classList.add('select');
				tabContainers[1].style.display = 'block';
				saves[1].style.display = 'block';
				localStorage.setItem('saveIndex', 1);
			})
			if(window.plus) {
				plusReady();
			} else {
				document.addEventListener("plusready", plusReady, false);
			}
			//			获取时间列表
			var timeArr = [];
			var flag = false;

			function plusReady() {
				//			处理床位列表传值
				var w = plus.webview.currentWebview();
				var patientBed = w.PatientBed;
				var patientName = w.PatientName;
				var patientNumber = w.PatientNumber;
				var MRN = w.MRN;

				var detailMain = plus.webview.getWebviewById('detail_main.html');
				var savespecial = '';
				var saveDiet = '';
				var currentDateMed = document.getElementById('currentDateMed');
				window.addEventListener('hasChange', function() {
					var btnArray = ['取消', '保存'];
					mui.confirm('当前存在未保存的数据，是否保存？', '', btnArray, function(e) {
						if(e.index == 1) {
							savespecial();
							saveDiet();
							mui.fire(detailMain, 'selectTrue', {
								isSave: true
							})
						} else {
							listContainer.classList.remove('hasChange');
							mui.fire(detailMain, 'getParams', {
								hasChange: listContainer.classList.contains('hasChange')
							})
							mui.fire(detailMain, 'selectTrue', {
								isSave: false
							})
						}
					})
				})

				//			获取输入项的Dom
				var items = document.getElementById('items');
				//				获取系统时间
				mui.ajax({
					url: url,
					type: 'get',
					data: {
						msgBody: JSON.stringify({}),
						msgHeader: JSON.stringify({
							ServerName: 'GetSysDate',
							Format: 'json',
							CallOperator: '',
							Certificate: '123456'
						})
					},
					dataType: 'json',
					tiemOut: 10000,
					success: function(data) {
						var tempTime = data.Msg.split(' ')[0];
						currentDateTime = data.Msg;
						currentDate.innerHTML = tempTime;
						currentDateMed.innerHTML = tempTime;
						var currentHmArr = data.Msg.split(' ')[1].split(':');
						var currentHm = currentHmArr[0] + ':' + currentHmArr[1];
						//		下拉刷新
						mui.init({
							swipeBack: false,
							pullRefresh: {
								container: '#pullrefresh',
								down: {
									contentrefresh: '正在同步医嘱...',
									callback: pulldownRefresh
								}
							}
						});

						function pulldownRefresh() {
							setTimeout(function() {
								mui.ajax({
									url: url,
									type: 'get',
									data: {
										msgBody: JSON.stringify({}),
										msgHeader: JSON.stringify({
											ServerName: 'GetSysDate',
											Format: 'json',
											CallOperator: '',
											Certificate: '123456'
										})
									},
									dataType: 'json',
									tiemOut: 10000,
									success: function(data) {
										var tempTime = data.Msg.split(' ')[0];
										currentDate.innerHTML = tempTime;
										mui.ajax({
											url: url,
											type: 'get',
											data: {
												msgBody: JSON.stringify({
													PatientMRN: MRN,
													startTime: currentDate.innerHTML + ' 07:00:01',
													endTime: getNextDay(currentDate.innerHTML) + ' 07:00:00'
												}),
												msgHeader: JSON.stringify({
													ServerName: 'SynchronizeOrderStart',
													Format: 'json',
													CallOperator: '',
													Certificate: '123456'
												})
											},
											dataType: 'json',
											tiemOut: 10000,
											success: function(data) {
												if(data.Code == 0) {
													getDiet();
													getOralOrSpecial('0', 'OralMedicine');
													getOralOrSpecial('1', 'specialTreat');
													getMedList();
												} else {
													mui.toast('同步医嘱失败');
												}
												mui('#pullrefresh').pullRefresh().endPulldownToRefresh();
											},
											error: function() {
												mui.toast('连接超时，同步医嘱失败');
												mui('#pullrefresh').pullRefresh().endPulldownToRefresh();
											}
										})
										mui('#pullrefresh').pullRefresh().endPulldownToRefresh();
									},
									error: function() {
										mui.toast('连接超时');
									}
								})

							}, 2000)

						}
						//--------------------获取饮食方式及量---------------------------
						function getDiet() {
							mui.ajax({
								url: url,
								type: 'get',
								data: {
									msgBody: JSON.stringify({
										PatientMRN: MRN,
										StartTime: currentDate.innerHTML + " 07:01:00",
										EndTime: getNextDay(currentDate.innerHTML) + ' 07:00:00'
									}),
									msgHeader: JSON.stringify({
										ServerName: 'GetYYType',
										Format: 'json',
										CallOperator: '',
										Certificate: '123456'
									})
								},
								dataType: 'json',
								success: function(data) {
									//					动态加载饮食方式计量
									var dietName = document.getElementById('dietName');
									var dietNum = document.getElementById('dietNum');
									items.style.borderBottom = '1px solid #bdbdbd';
									items.style.borderTop = '1px solid #bdbdbd';
									if(data.Code == 0) {
										//					获取饮食方式计量Dom	
										if(data.Contents.length == 0) {
											dietName.innerHTML = '请确认饮食方式是否存在';
											dietNum.innerHTML = '';
											var html = template('itemsDisabledTpl', {});
											items.innerHTML = html;

										} else {
											dietName.innerHTML = '';
											dietNum.innerHTML = data.Contents[0].OperateContent;

											flag = true;
											//			获取时间dom
											var three = document.getElementsByClassName('three')[0];
											var one = document.getElementsByClassName('one')[0];
											var two = document.getElementsByClassName('two')[0];
											//			获取时间列表
											mui.ajax({
												url: url,
												type: 'post',
												data: {
													msgBody: JSON.stringify({
														PatientMRN: MRN,
														CurrentTime: currentDateTime
													}),
													msgHeader: JSON.stringify({
														ServerName: 'GetTimeList',
														Format: 'json',
														CallOperator: '',
														Certificate: '123456'
													})
												},
												dataType: 'json',
												success: function(data) {
													for(var i = 0; i < data.Contents.length; i++) {
														timeArr.push(data.Contents[i].Time);
													}
													var hour = new Date().getHours();
													//设置时间的默认值为当前时间
													for(var i = 0; i < timeArr.length; i++) {
														var colonIndex = timeArr[i].indexOf(':');
														var nextIndex = i + 1 >= timeArr.length - 1 ? 0 : i + 1;
														if(timeArr[i].substring(0, colonIndex) <= hour && timeArr[nextIndex].substring(0, colonIndex) > hour) {

															two.innerHTML = timeArr[i];
															two.setAttribute('index', i);
															if(i <= 0) {
																three.innerHTML = timeArr[i + 1];
																three.setAttribute('index', i + 1);
																one.innerHTML = '';
																one.setAttribute('index', timeArr.length - 1);
																continue;
															}
															if(i >= timeArr.length - 1) {
																one.innerHTML = timeArr[i - 1];
																one.setAttribute('index', i - 1);
																three.innerHTML = '';
																three.setAttribute('index', 0);
																continue;
															}
															one.innerHTML = timeArr[i - 1];
															one.setAttribute('index', i - 1);
															three.innerHTML = timeArr[i + 1];
															three.setAttribute('index', i + 1);
														}
													}
													var timeBoxs = document.getElementsByClassName('time')[0].children;
													//设置位置
													for(var i = 0; i < timeBoxs.length; i++) {
														timeBoxs[i].style.left = 170 * i / 100 + 'rem';
													}
													//					如果饮食及量显示,则可以对时间列表进行操作
													document.getElementsByClassName('items')[0].classList.remove('hasSave');
													if(flag) {
														//						查找当前时间的记录

														mui.ajax({
															url: url,
															type: 'post',
															data: {
																msgBody: JSON.stringify({
																	PatientMRN: MRN,
																	OperateTime: currentDate.innerHTML + " " + two.innerHTML + ":00"
																}),
																msgHeader: JSON.stringify({
																	ServerName: 'GetYYIntakeByTime',
																	Format: 'json',
																	CallOperator: '',
																	Certificate: '123456'
																})
															},
															dataType: 'json',
															success: function(data) {
																var html = template('itemsTpl', {
																	list: data.Contents
																});
																items.innerHTML = html;
																items.style.borderBottom = '1px solid #bdbdbd';
																items.style.borderTop = '1px solid #bdbdbd';
																var inputs = document.getElementsByClassName('itemNum');

																for(var i = 0; i < inputs.length; i++) {
																	if(inputs[i].value) {
																		document.getElementsByClassName('items')[0].classList.add('hasSave');
																	}
																	inputs[i].addEventListener('change', function() {
																		listContainer.classList.add('hasChange');
																		mui.fire(detailMain, 'getParams', {
																			hasChange: listContainer.classList.contains('hasChange')
																		})
																	})

																}

															},
															error: function() {
																var html = template('itemsDisabledTpl', {
																	list: data.Contents
																});

																items.innerHTML = html;
																items.style.borderBottom = '1px solid #bdbdbd';
																items.style.borderTop = '1px solid #bdbdbd';
																mui.toast('服务器异常，请稍后再试');
															}
														});
														//					
														//						修改时间
														two.addEventListener('tap', function() {
															this.style.display = 'none';
															this.previousElementSibling.value = this.innerHTML;

														})
														//						查询最近的记录
														one.addEventListener('tap', function() {
															document.getElementsByClassName('items')[0].classList.remove('hasSave');
															if(!this.innerHTML) {
																return;
															}
															var this_ = this;
															if(listContainer.classList.contains('hasChange')) {
																var btnArray = ['取消', '保存'];
																mui.confirm('当前存在未保存的数据，是否保存？', '', btnArray, function(e) {
																	if(e.index == 1) {
																		saveDiet();
																		return;
																	} else {
																		listContainer.classList.remove('hasChange');
																		mui.fire(detailMain, 'getParams', {
																			hasChange: listContainer.classList.contains('hasChange')
																		})
																		var thisInnerHtml = this_.innerHTML;
																		var tapIndex = parseInt(one.getAttribute('index'));
																		if(tapIndex == 9) {
																			currentDate.innerHTML = getPreDay(currentDate.innerHTML);
																		}
																		two.innerHTML = timeArr[tapIndex];
																		two.setAttribute('index', tapIndex);
																		three.innerHTML = timeArr[tapIndex + 1];
																		three.setAttribute('index', parseInt(tapIndex + 1));
																		if(tapIndex <= 0) {
																			one.innerHTML = '';
																			one.setAttribute('index', 0);
																		} else {
																			one.innerHTML = timeArr[tapIndex - 1];
																			one.setAttribute('index', tapIndex - 1);
																		}
																		mui.ajax({
																			url: url,
																			type: 'post',
																			data: {
																				msgBody: JSON.stringify({
																					PatientMRN: MRN,
																					OperateTime: currentDate.innerHTML + " " + thisInnerHtml + ":00",
																				}),
																				msgHeader: JSON.stringify({
																					ServerName: 'GetYYIntakeByTime',
																					Format: 'json',
																					CallOperator: '',
																					Certificate: '123456'
																				})
																			},
																			beforeSend: function() {
																				plus.nativeUI.showWaiting('加载中…');
																			},
																			dataType: 'json',
																			success: function(data) {
																				if(data.Code == 0) {
																					plus.nativeUI.closeWaiting();
																					var html = template('itemsTpl', {
																						list: data.Contents
																					});
																					items.innerHTML = html;
																					items.style.borderBottom = '1px solid #bdbdbd';
																					items.style.borderTop = '1px solid #bdbdbd';
																				} else {
																					plus.nativeUI.closeWaiting();
																					var html = template('itemsTpl', {
																						list: data.Contents
																					});
																					items.innerHTML = html;
																					items.style.borderBottom = '1px solid #bdbdbd';
																					items.style.borderTop = '1px solid #bdbdbd';
																				}
																				var inputs = document.getElementsByClassName('itemNum');
																				for(var i = 0; i < inputs.length; i++) {
																					if(inputs[i].value) {
																						document.getElementsByClassName('items')[0].classList.add('hasSave');
																					}
																					inputs[i].addEventListener('change', function() {

																						listContainer.classList.add('hasChange');
																						mui.fire(detailMain, 'getParams', {
																							hasChange: listContainer.classList.contains('hasChange')
																						})
																					})

																				}
																			},
																			error: function() {
																				plus.nativeUI.closeWaiting();
																				mui.toast('服务器异常，请稍后再试');
																			}
																		})

																	}
																})
																return;
															}

															var thisInnerHtml = this.innerHTML;
															var tapIndex = parseInt(one.getAttribute('index'));
															if(tapIndex == 9) {
																currentDate.innerHTML = getPreDay(currentDate.innerHTML);
															}
															two.innerHTML = timeArr[tapIndex];
															two.setAttribute('index', tapIndex);
															three.innerHTML = timeArr[tapIndex + 1];
															three.setAttribute('index', parseInt(tapIndex + 1));
															if(tapIndex <= 0) {
																one.innerHTML = '';
																one.setAttribute('index', 0);
															} else {
																one.innerHTML = timeArr[tapIndex - 1];
																one.setAttribute('index', tapIndex - 1);
															}
															mui.ajax({
																url: url,
																type: 'post',
																data: {
																	msgBody: JSON.stringify({
																		PatientMRN: MRN,
																		OperateTime: currentDate.innerHTML + " " + thisInnerHtml + ":00",
																	}),
																	msgHeader: JSON.stringify({
																		ServerName: 'GetYYIntakeByTime',
																		Format: 'json',
																		CallOperator: '',
																		Certificate: '123456'
																	})
																},
																beforeSend: function() {
																	plus.nativeUI.showWaiting('加载中…');
																},
																dataType: 'json',
																success: function(data) {
																	if(data.Code == 0) {
																		plus.nativeUI.closeWaiting();
																		var html = template('itemsTpl', {
																			list: data.Contents
																		});
																		items.innerHTML = html;
																		items.style.borderBottom = '1px solid #bdbdbd';
																		items.style.borderTop = '1px solid #bdbdbd';
																	} else {
																		plus.nativeUI.closeWaiting();
																		var html = template('itemsTpl', {
																			list: data.Contents
																		});
																		items.innerHTML = html;
																		items.style.borderBottom = '1px solid #bdbdbd';
																		items.style.borderTop = '1px solid #bdbdbd';
																	}
																	var inputs = document.getElementsByClassName('itemNum');
																	for(var i = 0; i < inputs.length; i++) {
																		if(inputs[i].value) {
																			document.getElementsByClassName('items')[0].classList.add('hasSave');
																		}
																		inputs[i].addEventListener('change', function() {

																			listContainer.classList.add('hasChange');
																			mui.fire(detailMain, 'getParams', {
																				hasChange: listContainer.classList.contains('hasChange')
																			})
																		})

																	}
																},
																error: function() {
																	plus.nativeUI.closeWaiting();
																	mui.toast('服务器异常，请稍后再试');
																}
															})
														})
														//						切换到最新的时间
														three.addEventListener('tap', function() {
															document.getElementsByClassName('items')[0].classList.remove('hasSave');
															if(!this.innerHTML) {
																return;
															}
															var _that = this;
															if(listContainer.classList.contains('hasChange')) {
																var btnArray = ['取消', '保存'];
																mui.confirm('当前存在未保存的数据，是否保存？', '', btnArray, function(e) {
																	if(e.index == 1) {
																		saveDiet();
																		return;
																	} else {
																		listContainer.classList.remove('hasChange');
																		mui.fire(detailMain, 'getParams', {
																			hasChange: listContainer.classList.contains('hasChange')
																		})
																		var thisInnerHtml = _that.innerHTML;
																		var tapIndex = parseInt(three.getAttribute('index'));
																		if(tapIndex == 10) {
																			currentDate.innerHTML = getNextDay(currentDate.innerHTML);
																		}
																		two.innerHTML = timeArr[tapIndex];
																		two.setAttribute('index', tapIndex);
																		one.innerHTML = timeArr[tapIndex - 1];
																		one.setAttribute('index', tapIndex - 1);
																		if(tapIndex >= timeArr.length - 1) {
																			three.innerHTML = "";
																			three.setAttribute('index', timeArr.length - 1);
																		} else {
																			three.innerHTML = timeArr[tapIndex + 1];
																			three.setAttribute('index', parseInt(tapIndex + 1));
																		}
																		mui.ajax({
																			url: url,
																			type: 'post',
																			data: {
																				msgBody: JSON.stringify({
																					PatientMRN: MRN,
																					OperateTime: currentDate.innerHTML + " " + thisInnerHtml + ":00"
																				}),
																				msgHeader: JSON.stringify({
																					ServerName: 'GetYYIntakeByTime',
																					Format: 'json',
																					CallOperator: '',
																					Certificate: '123456'
																				})
																			},
																			beforeSend: function() {
																				plus.nativeUI.showWaiting('加载中…');
																			},
																			dataType: 'json',
																			success: function(data) {
																				if(data.Code == 0) {
																					plus.nativeUI.closeWaiting();
																					var html = template('itemsTpl', {
																						list: data.Contents
																					});
																					items.innerHTML = html;
																					items.style.borderBottom = '1px solid #bdbdbd';
																					items.style.borderTop = '1px solid #bdbdbd';
																				} else {
																					plus.nativeUI.closeWaiting();
																					var html = template('itemsTpl', {
																						list: data.Contents
																					});
																					items.innerHTML = html;
																					items.style.borderBottom = '1px solid #bdbdbd';
																					items.style.borderTop = '1px solid #bdbdbd';
																				}
																				var inputs = document.getElementsByClassName('itemNum');
																				for(var i = 0; i < inputs.length; i++) {
																					if(inputs[i].value) {
																						document.getElementsByClassName('items')[0].classList.add('hasSave');
																					}
																					inputs[i].addEventListener('change', function() {

																						listContainer.classList.add('hasChange');
																						mui.fire(detailMain, 'getParams', {
																							hasChange: listContainer.classList.contains('hasChange')
																						})
																					})

																				}
																			},
																			error: function() {
																				plus.nativeUI.closeWaiting();
																				var html = template('itemsDisabledTpl', {
																					list: data.Contents
																				});
																				items.innerHTML = html;
																				items.style.borderBottom = '1px solid #bdbdbd';
																				items.style.borderTop = '1px solid #bdbdbd';
																				mui.toast('服务器异常，请稍后再试');
																			}
																		});

																	}
																})
																return;
															}

															var thisInnerHtml = this.innerHTML;
															var tapIndex = parseInt(three.getAttribute('index'));
															if(tapIndex == 10) {
																currentDate.innerHTML = getNextDay(currentDate.innerHTML);
															}
															two.innerHTML = timeArr[tapIndex];
															two.setAttribute('index', tapIndex);
															one.innerHTML = timeArr[tapIndex - 1];
															one.setAttribute('index', tapIndex - 1);
															if(tapIndex >= timeArr.length - 1) {
																three.innerHTML = "";
																three.setAttribute('index', timeArr.length - 1);
															} else {
																three.innerHTML = timeArr[tapIndex + 1];
																three.setAttribute('index', parseInt(tapIndex + 1));
															}

															mui.ajax({
																url: url,
																type: 'post',
																data: {
																	msgBody: JSON.stringify({
																		PatientMRN: MRN,
																		OperateTime: currentDate.innerHTML + " " + thisInnerHtml + ":00"
																	}),
																	msgHeader: JSON.stringify({
																		ServerName: 'GetYYIntakeByTime',
																		Format: 'json',
																		CallOperator: '',
																		Certificate: '123456'
																	})
																},
																beforeSend: function() {
																	plus.nativeUI.showWaiting('加载中…');
																},
																dataType: 'json',
																success: function(data) {
																	if(data.Code == 0) {
																		plus.nativeUI.closeWaiting();
																		var html = template('itemsTpl', {
																			list: data.Contents
																		});
																		items.innerHTML = html;
																	} else {
																		plus.nativeUI.closeWaiting();
																		var html = template('itemsTpl', {
																			list: data.Contents
																		});
																		items.innerHTML = html;
																	}
																	var inputs = document.getElementsByClassName('itemNum');
																	for(var i = 0; i < inputs.length; i++) {
																		if(inputs[i].value) {
																			document.getElementsByClassName('items')[0].classList.add('hasSave');
																		}
																		inputs[i].addEventListener('change', function() {

																			listContainer.classList.add('hasChange');
																			mui.fire(detailMain, 'getParams', {
																				hasChange: listContainer.classList.contains('hasChange')
																			})
																		})

																	}
																},
																error: function() {
																	plus.nativeUI.closeWaiting();
																	var html = template('itemsDisabledTpl', {
																		list: data.Contents
																	});
																	items.innerHTML = html;
																	mui.toast('服务器异常，请稍后再试');
																}
															});
														});

														//						保存并上传数据
														document.getElementById('saveBtn').addEventListener('tap', function() {
															saveDiet();
														})
														saveDiet = function() {
															if(!listContainer.classList.contains('hasChange')) {
																mui.toast('当前数据已保存或者未填入数据');
																return;
															}
															var saveObj = {
																PatientMRN: MRN,
																PatientNumber: patientNumber,
																PatientName: patientName,
																OperateTime: currentDate.innerHTML + " " + two.innerHTML + ":00",
																UserCode: JSON.parse(window.localStorage.getItem('loginInfo')).UserName,
																UserName: JSON.parse(window.localStorage.getItem('loginInfo')).Name,
																ColumnID: parseInt(two.getAttribute('index')) + 3 + '',
																IntakeList: []
															};
															//							获取要保存的DOM节点
															var selectTimes = document.getElementsByClassName('selectTime');
															var itemNames = document.getElementsByClassName('itemName');
															var itemNums = document.getElementsByClassName('itemNum');
															for(var i = 0; i < 3; i++) {
																saveObj.IntakeList.push({
																	IntakeSupplyName: itemNames[i].getAttribute('name'),
																	IntakeNumber: itemNums[i].value,
																	IntakeUseType: '营养',
																	OperateTime: currentDate.innerHTML + selectTimes[i].value + ':00'
																})
															}
															mui.ajax({
																url: url,
																type: 'post',
																data: {
																	msgBody: JSON.stringify(saveObj),
																	msgHeader: JSON.stringify({
																		ServerName: 'SaveIntake',
																		Format: 'json',
																		CallOperator: '',
																		Certificate: '123456'
																	})
																},
																beforeSend: function() {
																	plus.nativeUI.showWaiting('正在保存中…');
																},
																dataType: 'json',
																success: function(data) {
																	if(data.Code == 0) {
																		setTimeout(function() {
																			mui.toast('数据保存成功');
																			plus.nativeUI.closeWaiting();
																			document.getElementsByClassName('items')[0].classList.add('hasSave');
																			listContainer.classList.remove('hasChange');
																			mui.fire(detailMain, 'getParams', {
																				hasChange: listContainer.classList.contains('hasChange')
																			})
																		}, 1000);

																	} else {
																		plus.nativeUI.closeWaiting();
																		mui.toast('服务器异常，请稍后再试');
																	}
																},
																error: function() {
																	plus.nativeUI.closeWaiting();
																	mui.toast('服务器异常，请稍后再试');
																}
															})
														}

													}
												},
												error: function() {
													plus.nativeUI.closeWaiting();
													mui.toast('服务器异常，请稍后再试');
												}
											});
										}

									} else {
										dietName.innerHTML = '请确认饮食方式是否存在';
										dietNum.innerHTML = '';
										var html = template('itemsDisabledTpl', {});
										items.innerHTML = html;

									}
								},
								error: function() {
									mui.toast('服务器异常，请稍后再试');
									dietName.innerHTML = '请确认饮食方式是否存在';
									dietNum.innerHTML = '';
									var html = template('itemsDisabledTpl', {});
									items.innerHTML = html;
								}
							})

						}
						getDiet();
						//--------------------用药部分-----------------------------

						//						先获取口服和特殊治疗
						getOralOrSpecial('0', 'OralMedicine');
						getOralOrSpecial('1', 'specialTreat');
						//						获取口服药或者特殊治疗的方法
						function getOralOrSpecial(intakeType, id) {
							mui.ajax({
								url: url,
								type: 'get',
								data: {
									msgBody: JSON.stringify({
										PatientMRN: MRN,
										StartTime: currentDateMed.innerHTML + " 07:01:00",
										EndTime: getNextDay(currentDateMed.innerHTML) + ' 07:00:00',
										IntakePoType: intakeType
									}),
									msgHeader: JSON.stringify({
										ServerName: 'GetIntakePo',
										Format: 'json',
										CallOperator: '',
										Certificate: '123456'
									})
								},
								dataType: 'json',
								success: function(data) {
									if(data.Code == 0) {
										if(data.Contents.length != 0) {
											var html = template('specialTpl', {
												list: data.Contents
											});
											document.getElementById(id).innerHTML = html;
											var times = document.getElementsByClassName('times');
											var clearBtns = document.getElementsByClassName('clearBtn');
											for(var i = 0; i < times.length; i++) {
												if(times[i].children.length == 1) {
													times[i].style.display = 'none';
													times[i].previousElementSibling.style.borderBottom = '1px solid #bebebe'
												} else {
													times[i].style.display = 'block';
													times[i].previousElementSibling.style.borderBottom = 'none'
												}
											}
											mui('.times').on('tap', '.clearBtn', function() {

												this.parentNode.removeChild(this.parentNode.lastElementChild);
												if(!this.nextElementSibling) {
													this.parentNode.style.display = 'none';
													this.parentNode.previousElementSibling.style.borderBottom = '1px solid #bebebe';
												}
											});
										}

									}
								},
								error: function(data) {
									mui.toast('服务器异常，请稍后再试');
								}
							})
						}
						//				保存口服和特殊治疗

						document.getElementById('saveSpecial').addEventListener('tap', function() {
							savespecial();
						});
						savespecial = function() {
							var saveItems = document.getElementsByClassName('saveItem');
							var saveParam = {
								PatientMRN: MRN,
								PatientNumber: patientNumber,
								PatientName: patientName,
								OperateTime: currentDateTime,
								UserCode: JSON.parse(window.localStorage.getItem('loginInfo')).UserName,
								UserName: JSON.parse(window.localStorage.getItem('loginInfo')).Name,
								IntakeList: []
							};
							for(var i = 0; i < saveItems.length; i++) {
								var thisTimesDom = saveItems[i].nextElementSibling.getElementsByClassName('singleTime');
								var thisTimes = '';
								for(var j = 0; j < thisTimesDom.length; j++) {
									thisTimes += thisTimesDom[j].innerHTML + '-';
								}
								thisTimes = thisTimes.substr(0, thisTimes.length - 1);
								saveParam.IntakeList.push({
									OrderNumber: saveItems[i].firstElementChild.getAttribute('OrderNumber'),
									IntakeNumber: saveItems[i].firstElementChild.getAttribute('IntakeNumber'),
									IntakeName: saveItems[i].firstElementChild.getAttribute('IntakeName'),
									IntakeUnit: saveItems[i].firstElementChild.getAttribute('IntakeUnit'),
									OperateTime: currentDateTime,
									ParentNumber: saveItems[i].firstElementChild.getAttribute('ParentNumber'),
									IntakeUseType: saveItems[i].firstElementChild.getAttribute('IntakeUseType'),
									Frequcy: saveItems[i].firstElementChild.getAttribute('Frequcy'),
									OrderCode: saveItems[i].firstElementChild.getAttribute('OrderCode'),
									IntakeCode: saveItems[i].firstElementChild.getAttribute('IntakeCode'),
									Value: thisTimes,
									Remarks: saveItems[i].firstElementChild.innerHTML
								})
							}
							mui.ajax({
								url: url,
								type: 'post',
								data: {
									msgBody: JSON.stringify(saveParam),
									msgHeader: JSON.stringify({
										ServerName: 'SaveIntake',
										Format: 'json',
										CallOperator: '',
										Certificate: '123456'
									})
								},
								beforeSend: function() {
									plus.nativeUI.showWaiting('正在保存中…');
								},
								dataType: 'json',
								success: function(data) {
									if(data.Code == 0) {
										setTimeout(function() {
											mui.toast('数据保存成功');
											plus.nativeUI.closeWaiting();
											listContainer.classList.remove('hasChange');
											mui.fire(detailMain, 'getParams', {
												hasChange: listContainer.classList.contains('hasChange')
											})
											getOralOrSpecial('1', 'specialTreat');
										}, 1000);

									} else {
										plus.nativeUI.closeWaiting();
										mui.toast('服务器异常，请稍后再试');
									}
								},
								error: function() {
									plus.nativeUI.closeWaiting();
									mui.toast('服务器异常');
								}
							})

						}
						//				获取输液单
						function getMedList() {
							mui.ajax({
								url: url,
								type: 'get',
								data: {
									msgBody: JSON.stringify({
										PatientMRN: MRN,
										StartTime: currentDateMed.innerHTML + ' 07:00:01',
										EndTime: getNextDay(currentDateMed.innerHTML) + " 07:00:00"
									}),
									msgHeader: JSON.stringify({
										ServerName: 'GetIntakeList',
										Format: 'json',
										CallOperator: '',
										Certificate: '123456'
									})
								},
								dataType: 'json',
								success: function(data) {
									if(data.Code == 0) {
										var html = template('infusionTpl', {
											datas: data.Contents
										});
										document.getElementById('InfusionList').innerHTML = html;
										//				用药主界面的tab栏切换,放在success中
										//				获取每个输液组DOM
										var infusionGroups = document.getElementsByClassName('infusionGroup');
										var opers = document.getElementsByClassName('opers');
										var activeOpers = document.getElementsByClassName('activeOper');
										var operParts = document.getElementsByClassName('operPart');
										var sureUpdates = document.getElementsByClassName('sureUpdate');
										for(var i = 0; i < infusionGroups.length; i++) {
											infusionGroups[i].addEventListener('tap', function() {
												for(var j = 0; j < opers.length; j++) {
													opers[j].style.display = 'none';
												}
												this.lastElementChild.style.display = 'flex';
												if(this.getAttribute('id') == '6') {
													this.lastElementChild.style.display = 'block';
												}
											})
											if(infusionGroups[i].getAttribute('id')==6){
												infusionGroups[i].classList.add('hasStop');
											}
										}
										
										//				如果是执行状态
										for(var n = 0; n < activeOpers.length; n++) {
											activeOpers[n].setAttribute('index', n);
											activeOpers[n].addEventListener('tap', function() {
												var activeIndex = parseInt(this.getAttribute('index'));
												for(var s = 0; s < operParts.length; s++) {
													operParts[s].style.display = 'none';
												}
												operParts[activeIndex].style.display = 'block';
											})
										}
										var checkBox = document.getElementById('isComplete');
										var totalValueDom = document.getElementById('totalValue');
										var ConsumptionValueDom = document.getElementById('ConsumptionValue');
										var pumpSpeedValueDom = document.getElementById('pumpSpeedValue');
										if(checkBox) {
											document.getElementById('status7').value = currentHm;
											checkBox.addEventListener('change', function() {
												if(this.checked) {
													document.getElementById('status7').removeAttribute('littleOver');
													document.getElementsByClassName('status7')[0].value = totalValueDom.innerHTML - ConsumptionValueDom.innerHTML;
													document.getElementById('affected').setAttribute('IsOver', '1');

													document.getElementById('status7').value = currentHm;

												} else {
													document.getElementsByClassName('status7')[0].value = '';
													document.getElementById('affected').setAttribute('IsOver', '0');
													document.getElementById('status7').value = '选择时间';
													document.getElementById('status7').setAttribute('littleOver', true);
												}

											})
											document.getElementById('status7').addEventListener('tap', function() {
												if(!this.getAttribute('littleOver')) {
													return;
												}
												var selectArea = document.getElementById('selectArea');
												selectArea.style.display = 'block';
												var mask = mui.createMask(function() {
													selectArea.style.display = 'none';
												});
												mask.show();
												var overItems = document.getElementsByClassName('overItem');
												for(var i = 0; i < overItems.length; i++) {
													overItems[i].addEventListener('tap', function() {
														document.getElementById('status7').value = this.innerHTML;
														selectArea.style.display = 'none';
														mask.close();
														mui.ajax({
															url: url,
															type: 'get',
															data: {
																msgBody: JSON.stringify({
																	IntakeCode: document.getElementsByClassName('sureUpdate')[0].getAttribute('IntakeCode'),
																	OperateTime: currentDateMed.innerHTML + document.getElementById('status7').value + ':00',
																	OperateStatus: '1'
																}),
																msgHeader: JSON.stringify({
																	ServerName: 'GetIntakeNumber',
																	Format: 'json',
																	CallOperator: '',
																	Certificate: '123456'
																})
															},
															dataType: 'json',
															success: function(data) {
																if(data.Code == 0) {
																	document.getElementsByClassName('status7')[0].value = data.Msg;
																} else {
																	mui.toast('' + data.Msg);
																}
															}
														})

													})
												}

											})

										}
										//				如果是暂停状态
										var begin = document.getElementById('begin');
										if(begin) {
											begin.addEventListener('tap', function() {
												this.nextElementSibling.style.display = 'block';
											})
										}
										var inputDoms = document.getElementsByClassName('inputDom');

										//				点击确认按钮
										for(var i = 0; i < sureUpdates.length; i++) {
											sureUpdates[i].addEventListener('tap', function() {
												var operateStatus = this.parentNode.getAttribute('status');
												var intakeNumber = operateStatus == 5 ? '0' : this.previousElementSibling.getElementsByClassName('fact')[0].value;
												var pumpValue = operateStatus == 1 ? document.getElementById('speedId').value : pumpSpeedValueDom.innerHTML;
												var itemTime = this.previousElementSibling.getElementsByClassName('itemTime')[0];
												var saveIntake = {
													OperateType: operateStatus,
													IntakeCode: this.getAttribute('IntakeCode'),
													PumpSpeed: pumpValue,
													OperateTime: currentDateMed.innerHTML + itemTime.value + ':00',
													UserCode: JSON.parse(window.localStorage.getItem('loginInfo')).UserName,
													UserName: JSON.parse(window.localStorage.getItem('loginInfo')).Name,
													IntakeNumber: intakeNumber,
													IsOver: this.getAttribute('isover')
												}
												mui.ajax({
													url: url,
													type: 'post',
													data: {
														msgBody: JSON.stringify(saveIntake),
														msgHeader: JSON.stringify({
															ServerName: 'SaveIntakeOperate',
															Format: 'json',
															CallOperator: '',
															Certificate: '123456'
														})
													},
													dataType: 'json',
													success: function(data) {
														if(data.Code == 0) {
															for(var s = 0; s < operParts.length; s++) {
																operParts[s].style.display = 'none';
															}
															itemTime.value = '选择时间';
															var facts = document.getElementsByClassName('fact');
															for(var j = 0; j < facts.length; j++) {
																facts[j].value = '';
															}
															document.getElementById('speedId').value = '';
															mui.toast('操作成功');
															var currentInPage = plus.webview.currentWebview();
															currentInPage.reload(true);
															localStorage.setItem('OperateSuccess', true);
														} else {
															mui.toast('服务器错误');
														}
													}
												})
											})
										}

									}

								}
							})

						}
						getMedList();
						window.addEventListener('getMedListFun', function() {
							getMedList();
						})
						//				点击扫码
						var scanBtn = document.getElementById('scanBtn');
						//						点击扫描二维码按钮,弹出扫描页面
						scanBtn.addEventListener('tap', function() {
							mui.openWindow({
								url: 'scan.html',
								id: 'scan.html',
								extras: {
									MRN: MRN,
									PatientName: patientName,
									PatientNumber: patientNumber,
									PatientBed: patientBed,
									systemDate: currentDateMed.innerHTML
								},
								show: {
									aniShow: 'none'
								}
							});
						})

						//				手动扫描获取二维码打开页面,获取药品
						var context = plus.android.importClass('android.content.Context'); //上下文
						var main = plus.android.runtimeMainActivity(); //获取activity
						var receiver = plus.android.implements('io.dcloud.feature.internal.reflect.BroadcastReceiver', {
							onReceive: doReceive //实现onReceiver回调函数
						});
						var IntentFilter = plus.android.importClass('android.content.IntentFilter');
						var Intent = plus.android.importClass('android.content.Intent');
						var filter = new IntentFilter();

						filter.addAction("lachesis_barcode_value_notice_broadcast"); //监听扫码状态
						main.registerReceiver(receiver, filter); //注册监听
						
						function doReceive(context, intent) {
							var intentCode = intent.getStringExtra("lachesis_barcode_value_notice_broadcast_data_string");
							if(/^\d{7}$/.test(intentCode)) {
								mui.ajax({
									url: url,
									type: 'get',
									data: {
										msgBody: JSON.stringify({
											
											"OrderNo": intentCode
										}),
										msgHeader: JSON.stringify({
											ServerName: 'ScanSearch',
											Format: 'json',
											CallOperator: '',
											Certificate: '123456'
										})
									},
									dataType: 'json',
									beforeSend: function() {
									plus.nativeUI.showWaiting('数据加载中…');
								},
									success: function(data) {
										plus.nativeUI.closeWaiting();
										if(data.Code == 0) {
											//	status为0,扫患者
											data.intentCode = intentCode;
											var scanData = JSON.stringify(data)
											if(data.STATUS == 0) {
												
												//												扫的码是患者的二维码
												if(data.MRN == MRN) {
													//													扫描的是当前患者
													
													localStorage.setItem('patientsScan', true);
													mui.openWindow({
														url: 'scan.html',
														id: 'scan.html',
														extras: {
															MRN: MRN,
															PatientName: patientName,
															PatientNumber: patientNumber,
															PatientBed: patientBed,
															systemDate: currentDateMed.innerHTML,
															scanData: scanData,
															STATUS: 0
														},
														show: {
															aniShow: 'none'
														}
													});
												} else {
													//													扫描的不是当前患者
													mui.openWindow({
														url: 'failed.html',
														id: 'failed.html',
														extras: {
															MRN: data.MRN,
															PatientName: data.Name,
															PatientNumber: data.PATIENTNUMBER,
															PatientBed: data.BedNo,
															systemDate: currentDateMed.innerHTML,
															isPatient: true,
															count: 1,
															scanData:scanData
														},
														
														show: {
															aniShow: 'none'
														}
													});
													//													判断是否扫过液体
													//													如果扫液体成功,跳到重新扫描

													//													如果没有扫液体成功,跳到患者的重新扫描和跳转(传患者信息还有扫描信息)
												}
											} else {
												//												扫的码是液体的码
												if(data.MRN != MRN) {
													//													扫的不是该宝宝的液体
													mui.openWindow({
														url: 'failed.html',
														id: 'failed.html',
														extras: {
															MRN: data.MRN,
															PatientName: data.Name,
															PatientNumber: data.PATIENTNUMBER,
															PatientBed: data.BedNo,
															systemDate: currentDateMed.innerHTML,
															isPatient: false,
															count: 1,
															scanData:scanData
														},
														show: {
															aniShow: 'none'
														}
													});
												} else {
													//													扫的是该宝宝的液体
													localStorage.setItem('medScan', true);
													var scanData = JSON.stringify(data)
													mui.openWindow({
														url: 'scan.html',
														id: 'scan.html',
														extras: {
															MRN: MRN,
															PatientName: patientName,
															PatientNumber: patientNumber,
															PatientBed: patientBed,
															systemDate: currentDateMed.innerHTML,
															scanData: scanData,
															STATUS:1
														},
														show: {
															aniShow: 'none'
														}
													});
												}
											}

										} else {
											mui.toast('未找到该组号液体，请确认医嘱');
											plus.nativeUI.closeWaiting();

										}
									},
									error: function() {
										plus.nativeUI.closeWaiting();

									}
								})

							} else {
								mui.toast('请扫描正确的二维码');
							}
						}

					},
					error: function() {
						mui.toast('连接超时');
					}
				})

			}
		</script>
		<script src="../js/updateTime.js"></script>
	</body>

</html>